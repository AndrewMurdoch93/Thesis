\tikzstyle{a}=[rectangle, draw=black, fill=white,thick, minimum width = 2cm, minimum height = 2cm, align=center, rounded corners=.1cm]
\tikzstyle{b}=[rectangle, draw=black, fill=white,thick, minimum width = 1cm, minimum height = 1cm,, align=center, rounded corners=.1cm]

\begin{tikzpicture}
 
    % Draw nodes
    \node (a) at (5,5)  [a] {End-to-end\\agent};
    \node (b) at (9,5.5)  [b] {Velocity\\constraint};
    \node (c) at (9,2.5)  [b] {Simulator};

    % Draw boxes around nodes
    %Driving architecture
    \draw[loosely dashed] ($(a)+(-1.5,-1.5)$) -| ($(b)+(1.3,1.5)$) -|  ($(a)+(-1.5,-1.5)$) node [pos=0.25,above] {Racing algorithm};
    %Environment
    % \draw[dotted] ($(c)+(-1.5,-1)$) -| ($(b)+(3,1)$) -|  ($(c)+(-1.5,-1)$) node [draw=white,pos=0.25,above,fill=white] {Environment};
    \draw[loosely dashed] ($(c)+(-1.5,-1)$) -| ($(b)+(3,1)$) node [pos=0.25,below] {Environment} -| ($(c)+(-1.5,-1)$);
    
    % Draw connections
    %agent to limit
    \draw[<-] (b) -- (b-|a.east);
    %Limit to simulator
    % \draw[->] (b) -- ($(b)+(2.5,0)$) -- ($(c)+(2.5,-0.2)$) -- ($(c.east)+(0,-0.2)$);
    
    \draw[->] (b) -| ($(c)+(2.5,-0.2)$) -- ($(c.east)+(0,-0.2)$);
    %Agent to simulator
    \draw[->] ($(a.east)+(0,-0.5)$) -| ($(c)+(2,0.2)$) -- ($(c.east)+(0,0.2)$);
    % \draw[->] ($(c)+(2,-0.2)$) -- (c);
    %Simulator to agent
    \draw[->] (c) -| ($(a)+(-2,0)$) node  [pos=0.25,above] {Observation} -- (a);

    % Label connections
    \node (l1) at ($(a.east)+(0,0.5)$) [above right] {$a_{\text{long},d}$};
    \node (l3) at ($(b.east)+(0,0)$) [above right, fill=white] {$a_{\text{long},d}$};
    \node (l2) at ($(a.east)+(0,-0.5)$) [above right] {$\delta_{d}$};

    %Inputs and output arrows
    % \draw[->] (0,0) -- (x1);
   
    % %lines between components
    % \draw[->] (-1.8,-1) -- (-1.4,-1) ; 
    % \draw[->] (z1) -- (z1-|a.west)  node [midway, above] (l1) {\small$\hat{y}_1 \in (-1,1)$} ;      
    % \draw[->] (z2) -- (z2-|a.west) node [midway, above] (l2) {\small$\hat{y}_2 \in (-1,1)$} ;               
    % \draw[->] ($(a)+(0.6,0.5)$) -- (b) ; 
    % \draw[->] (b) -- (10,-0.5) node [right] (l3) {\small $a_{\text{long},d}$ }; 
    % \draw[->] ($(a)+(0.6,-0.5)$) -- (10,-1.5) node [right] (l4) {\small $\delta_{d}$}; 

    % \node[text width=3.7cm, align=center] at (1.5,1) { \hbox{Neural} \hbox{network}  \hbox{policy} };
    
\end{tikzpicture}